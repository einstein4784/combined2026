@@include('partials/main.html')

<head>
    @@include("partials/title-meta.html", {"title": "Dashboard"})

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    @@include('partials/head-css.html')
    
    <style>
        .welcome-card {
            background: linear-gradient(135deg, #1a365d 0%, #2c4a7c 50%, #4fa896 100%);
            border-radius: 16px;
            color: white;
            overflow: hidden;
            position: relative;
        }
        
        .welcome-card::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -20%;
            width: 60%;
            height: 200%;
            background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='40' fill='rgba(255,255,255,0.05)'/%3E%3C/svg%3E") repeat;
            opacity: 0.3;
        }
        
        .welcome-card .welcome-content {
            position: relative;
            z-index: 1;
        }
        
        .stat-card {
            border-radius: 12px;
            border: none;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        }
        
        .stat-icon {
            width: 56px;
            height: 56px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .stat-icon.customers { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .stat-icon.policies { background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); }
        .stat-icon.outstanding { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        .stat-icon.payments { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
        
        .chart-card {
            border-radius: 12px;
            border: none;
        }
        
        .activity-item {
            padding: 12px 0;
            border-bottom: 1px solid #f0f0f0;
            transition: background 0.2s;
        }
        
        .activity-item:hover {
            background: #f8f9fa;
            margin: 0 -15px;
            padding: 12px 15px;
        }
        
        .activity-item:last-child {
            border-bottom: none;
        }
        
        .activity-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }
        
        .quick-action-btn {
            border-radius: 10px;
            padding: 12px 20px;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .quick-action-btn:hover {
            transform: translateY(-2px);
        }
        
        .coverage-badge {
            font-size: 10px;
            padding: 3px 8px;
            border-radius: 20px;
        }
        
        .live-indicator {
            display: inline-flex;
            align-items: center;
            font-size: 11px;
            color: #28a745;
        }
        
        .live-indicator::before {
            content: '';
            width: 8px;
            height: 8px;
            background: #28a745;
            border-radius: 50%;
            margin-right: 5px;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .trend-up { color: #28a745; }
        .trend-down { color: #dc3545; }
    </style>
</head>

<body>
    <!-- Authentication check -->
    <script>
        (async function() {
            try {
                const response = await fetch('http://localhost:3001/api/me', { credentials: 'include' });
                if (!response.ok) window.location.href = 'pages-login.html';
            } catch (error) {
                window.location.href = 'pages-login.html';
            }
        })();
    </script>

    <div class="layout-wrapper">
        @@include('partials/menu.html')

        <div class="page-content">
            @@include('partials/topbar.html')

            <div class="px-3">
                <div class="container-fluid">

                    <!-- Welcome Section -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <div class="card welcome-card">
                                <div class="card-body py-4">
                                    <div class="welcome-content">
                                        <div class="row align-items-center">
                                            <div class="col-lg-8">
                                                <h2 class="mb-2">Welcome back, <span id="welcomeUserName">User</span>! ðŸ‘‹</h2>
                                                <p class="mb-3 opacity-75">Here's what's happening with your insurance business today.</p>
                                                <div class="d-flex gap-2 flex-wrap">
                                                    <a href="customers.html" class="btn btn-light quick-action-btn">
                                                        <i data-lucide="user-plus" class="icon-sm me-1"></i> New Customer
                                                    </a>
                                                    <a href="policies.html" class="btn btn-outline-light quick-action-btn">
                                                        <i data-lucide="file-plus" class="icon-sm me-1"></i> Create Policy
                                                    </a>
                                                    <a href="payments.html" class="btn btn-outline-light quick-action-btn">
                                                        <i data-lucide="dollar-sign" class="icon-sm me-1"></i> Record Payment
                                                    </a>
                                                </div>
                                            </div>
                                            <div class="col-lg-4 text-lg-end mt-3 mt-lg-0">
                                                <div class="d-inline-block text-start" style="background: rgba(255,255,255,0.15); padding: 15px 20px; border-radius: 12px;">
                                                    <small class="opacity-75 d-block">Today's Date</small>
                                                    <h4 class="mb-0" id="todayDate">---</h4>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Stats Cards -->
                    <div class="row mb-4">
                        <div class="col-lg-3 col-md-6 mb-3 mb-lg-0">
                            <div class="card stat-card h-100">
                                <div class="card-body">
                                    <div class="d-flex align-items-center">
                                        <div class="stat-icon customers me-3">
                                            <i data-lucide="users" class="text-white" style="width:24px;height:24px;"></i>
                                        </div>
                                        <div>
                                            <p class="text-muted mb-1 small">Total Customers</p>
                                            <h3 class="mb-0" id="statTotalCustomers">0</h3>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-3 col-md-6 mb-3 mb-lg-0">
                            <div class="card stat-card h-100">
                                <div class="card-body">
                                    <div class="d-flex align-items-center">
                                        <div class="stat-icon policies me-3">
                                            <i data-lucide="file-text" class="text-white" style="width:24px;height:24px;"></i>
                                        </div>
                                        <div>
                                            <p class="text-muted mb-1 small">Active Policies</p>
                                            <h3 class="mb-0" id="statActivePolicies">0</h3>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-3 col-md-6 mb-3 mb-lg-0">
                            <div class="card stat-card h-100">
                                <div class="card-body">
                                    <div class="d-flex align-items-center">
                                        <div class="stat-icon outstanding me-3">
                                            <i data-lucide="alert-circle" class="text-white" style="width:24px;height:24px;"></i>
                                        </div>
                                        <div>
                                            <p class="text-muted mb-1 small">Outstanding</p>
                                            <h3 class="mb-0 text-danger" id="statTotalOutstanding">$0</h3>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-3 col-md-6">
                            <div class="card stat-card h-100">
                                <div class="card-body">
                                    <div class="d-flex align-items-center">
                                        <div class="stat-icon payments me-3">
                                            <i data-lucide="trending-up" class="text-white" style="width:24px;height:24px;"></i>
                                        </div>
                                        <div>
                                            <p class="text-muted mb-1 small">Today's Collections</p>
                                            <h3 class="mb-0 text-success" id="statTodayPayments">$0</h3>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Charts Row -->
                    <div class="row mb-4">
                        <div class="col-lg-8 mb-4 mb-lg-0">
                            <div class="card chart-card h-100">
                                <div class="card-header bg-transparent border-0 d-flex justify-content-between align-items-center">
                                    <div>
                                        <h5 class="mb-0">Monthly Collections</h5>
                                        <small class="text-muted">Payment trends over last 6 months</small>
                                    </div>
                                    <span class="live-indicator">Live Data</span>
                                </div>
                                <div class="card-body">
                                    <canvas id="collectionsChart" height="280"></canvas>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4">
                            <div class="card chart-card h-100">
                                <div class="card-header bg-transparent border-0">
                                    <h5 class="mb-0">Coverage Distribution</h5>
                                    <small class="text-muted">Policy types breakdown</small>
                                </div>
                                <div class="card-body">
                                    <canvas id="coverageChart" height="250"></canvas>
                                    <div class="row text-center mt-3">
                                        <div class="col-6">
                                            <h4 class="mb-0" id="thirdPartyCount">0</h4>
                                            <small class="text-muted">Third Party</small>
                                        </div>
                                        <div class="col-6">
                                            <h4 class="mb-0" id="fullyCompCount">0</h4>
                                            <small class="text-muted">Fully Comp</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Activity Lists -->
                    <div class="row">
                        <!-- Recent Customers -->
                        <div class="col-lg-4 mb-4">
                            <div class="card h-100">
                                <div class="card-header bg-transparent border-0 d-flex justify-content-between align-items-center">
                                    <div>
                                        <h5 class="mb-0"><i data-lucide="users" class="icon-sm me-2 text-primary"></i>Recent Customers</h5>
                                    </div>
                                    <a href="customers.html" class="btn btn-sm btn-outline-primary">View All</a>
                                </div>
                                <div class="card-body pt-0" id="recentCustomersList">
                                    <div class="text-center py-4 text-muted">
                                        <div class="spinner-border spinner-border-sm" role="status"></div>
                                        <p class="mb-0 mt-2">Loading...</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Recent Policies -->
                        <div class="col-lg-4 mb-4">
                            <div class="card h-100">
                                <div class="card-header bg-transparent border-0 d-flex justify-content-between align-items-center">
                                    <div>
                                        <h5 class="mb-0"><i data-lucide="file-text" class="icon-sm me-2 text-success"></i>Recent Policies</h5>
                                    </div>
                                    <a href="policies.html" class="btn btn-sm btn-outline-success">View All</a>
                                </div>
                                <div class="card-body pt-0" id="recentPoliciesList">
                                    <div class="text-center py-4 text-muted">
                                        <div class="spinner-border spinner-border-sm" role="status"></div>
                                        <p class="mb-0 mt-2">Loading...</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Recent Payments -->
                        <div class="col-lg-4 mb-4">
                            <div class="card h-100">
                                <div class="card-header bg-transparent border-0 d-flex justify-content-between align-items-center">
                                    <div>
                                        <h5 class="mb-0"><i data-lucide="credit-card" class="icon-sm me-2 text-info"></i>Recent Payments</h5>
                                    </div>
                                    <a href="payments.html" class="btn btn-sm btn-outline-info">View All</a>
                                </div>
                                <div class="card-body pt-0" id="recentPaymentsList">
                                    <div class="text-center py-4 text-muted">
                                        <div class="spinner-border spinner-border-sm" role="status"></div>
                                        <p class="mb-0 mt-2">Loading...</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>

            @@include('partials/footer.html')
        </div>
    </div>

    @@include('partials/footer-scripts.html')
    <script src="assets/js/pages/dashboard.js"></script>
</body>
</html>
